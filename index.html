<!DOCTYPE html>
<html>
<head>
<title>Ultra Color Engine 2025 Pro</title>
<style>
body{background:#111;color:#fff;font-family:Arial;text-align:center}
button{width:55px;height:55px;margin:4px;font-size:18px;border-radius:8px;border:none;cursor:pointer}
.controlBtn{width:120px;background:#444;color:white}
.meter{width:300px;height:20px;background:#333;border-radius:10px;margin:10px auto;overflow:hidden}
.fill{height:100%;width:0%;line-height:20px;font-size:12px;font-weight:bold}
#priority{margin-top:15px;font-size:18px;padding:10px;border-radius:8px}
</style>
</head>
<body>

<h2>ULTRA COLOR ENGINE 2025 (Mixed Strategy)</h2>

<div id="buttons"></div>
<br>
<button class="controlBtn" onclick="undo()">UNDO</button>
<button class="controlBtn" onclick="resetAll()">RESET</button>

<div id="history"></div>
<div id="result"></div>

<h3>Confidence</h3>
<div class="meter"><div id="confidenceBar" class="fill"></div></div>

<div id="priority"></div>

<script>

let history=[];
const MAX_HISTORY=15;

// ===== CORRECT COLOR LOGIC =====
function getColor(n){
 if(n==0||n==5) return "Violet";
 if([1,3,7,9].includes(n)) return "Green";
 return "Red";
}

function getSize(n){
 return n<=4 ? "Small" : "Big";
}

// Create digit buttons
for(let i=0;i<=9;i++){
 let b=document.createElement("button");
 b.innerText=i;
 b.onclick=()=>addNumber(i);
 document.getElementById("buttons").appendChild(b);
}

function addNumber(n){
 history.push(n);
 if(history.length>MAX_HISTORY){
   history.shift();
 }
 updateDisplay();
 analyze();
}

function undo(){
 if(history.length>0){
   history.pop();
   updateDisplay();
   analyze();
 }
}

function resetAll(){
 history=[];
 document.getElementById("history").innerHTML="";
 document.getElementById("result").innerHTML="";
 document.getElementById("priority").innerHTML="";
 document.getElementById("confidenceBar").style.width="0%";
 document.getElementById("confidenceBar").innerText="";
}

function updateDisplay(){
 document.getElementById("history").innerText=
 history.length>0?"History (Last 15): "+history.join(", "):"History Empty";
}

function analyze(){

 if(history.length<5){
   document.getElementById("result").innerText="Need minimum 5 results...";
   return;
 }

 let votes={Red:0,Green:0,Violet:0};

 let colors=history.map(getColor);
 let sizes=history.map(getSize);

 // ===== RULE 1: Violet absence (last 3) =====
 let last3=colors.slice(-3);
 if(!last3.includes("Violet")){
   votes["Violet"]+=3;
 }

 // ===== RULE 2: 10 round balance =====
 let last10=colors.slice(-10);
 let count={Red:0,Green:0,Violet:0};
 last10.forEach(c=>count[c]++);

 if(count.Green<4) votes.Green+=2;
 if(count.Red<3) votes.Red+=2;
 if(count.Violet<2) votes.Violet+=2;

 // ===== RULE 3: Big/Small reversal =====
 let last2=sizes.slice(-2);
 if(last2.length==2 && last2[0]==last2[1]){
   let expected= last2[1]=="Small"?"Big":"Small";
   if(expected=="Big"){
     votes.Red+=1;
     votes.Green+=1;
   }else{
     votes.Violet+=1;
   }
 }

 // ===== RULE 4: Last Digit Mapping =====
 let mapping={
 0:[5,2],1:[9,3],2:[0,8],3:[1,7],4:[6,2],
 5:[0,5],6:[4,8],7:[3,9],8:[6,2],9:[1,7]
 };

 let lastDigit=history[history.length-1];
 let nextDigits=mapping[lastDigit];

 nextDigits.forEach(d=>{
   votes[getColor(d)]+=2;
 });

 // ===== FINAL COLOR =====
 let final=Object.keys(votes)
   .reduce((a,b)=>votes[a]>votes[b]?a:b);

 let totalVotes=votes.Red+votes.Green+votes.Violet;
 let confidence= totalVotes>0 ?
   Math.round((votes[final]/totalVotes)*100) : 0;

 // ===== DIGIT PROBABILITY =====
 let digitCount={};
 for(let i=0;i<=9;i++) digitCount[i]=0;

 history.forEach(n=>digitCount[n]++);

 let digitProb=[];
 for(let i=0;i<=9;i++){
   digitProb.push({
     digit:i,
     prob:(digitCount[i]/history.length)*100
   });
 }

 digitProb.sort((a,b)=>b.prob-a.prob);

 let top1=digitProb[0];
 let top2=digitProb[1];

 // ===== DISPLAY =====
 document.getElementById("result").innerHTML=
 "<br>Next Color: <b>"+final+"</b><br>"+
 "Confidence: "+confidence+"%<br><br>"+
 "Top 2 Digits:<br>"+
 "1Ô∏è‚É£ "+top1.digit+" ("+top1.prob.toFixed(1)+"%)<br>"+
 "2Ô∏è‚É£ "+top2.digit+" ("+top2.prob.toFixed(1)+"%)";

 let bar=document.getElementById("confidenceBar");
 bar.style.width=confidence+"%";
 bar.innerText=confidence+"%";
 bar.style.background=
 final=="Red"?"red":
 final=="Green"?"green":"purple";

 let priority=document.getElementById("priority");

 if(confidence>=75){
   priority.innerHTML="üî• Strong Signal ‚Üí Play "+final;
   priority.style.background="darkgreen";
 }
 else if(confidence>=60){
   priority.innerHTML="‚ö° Medium Signal ‚Üí Controlled Entry";
   priority.style.background="orange";
 }
 else{
   priority.innerHTML="‚ö† Weak Signal ‚Üí Skip";
   priority.style.background="#555";
 }

}

</script>
</body>
</html>
